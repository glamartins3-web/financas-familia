<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Controle Financeiro</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root {
  --bg: #f4f6f8;
  --card: #ffffff;
  --text: #222;
  --primary: #2563eb;
}
body.dark {
  --bg: #0f172a;
  --card: #020617;
  --text: #e5e7eb;
  --primary: #38bdf8;
}
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: var(--bg);
  color: var(--text);
}
header {
  background: var(--card);
  padding: 12px 16px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}
header strong {
  color: var(--primary);
}
nav {
  display: flex;
  gap: 12px;
}
nav button {
  border: none;
  background: none;
  font-size: 14px;
  cursor: pointer;
  color: var(--text);
}
main {
  padding: 16px;
}
.card {
  background: var(--card);
  border-radius: 10px;
  padding: 16px;
  margin-bottom: 16px;
}
input, select, button {
  padding: 10px;
  width: 100%;
  margin-bottom: 10px;
}
button.primary {
  background: var(--primary);
  color: #fff;
  border: none;
  border-radius: 6px;
  cursor: pointer;
}
.toggle-dark {
  position: fixed;
  bottom: 16px;
  right: 16px;
  padding: 10px;
  border-radius: 50%;
  background: var(--primary);
  color: #fff;
  cursor: pointer;
}
.hidden { display: none; }
</style>
</head>

<body>

<!-- LOGIN -->
<div id="loginView" class="card">
  <h2>ğŸ” Login</h2>
  <input id="user" placeholder="UsuÃ¡rio">
  <input id="pass" type="password" placeholder="Senha">
  <button class="primary" onclick="login()">Entrar</button>
  <p id="loginErro" style="color:red;"></p>
</div>

<!-- APP -->
<div id="appView" class="hidden">
  <header>
    <div>OlÃ¡, <strong id="userName"></strong></div>
    <nav>
      <button onclick="showTab('lancamentos')">ğŸ’¸ LanÃ§amentos</button>
      <button onclick="showTab('historico')">ğŸ“Š HistÃ³rico</button>
      <button onclick="logout()">â» Sair</button>
    </nav>
  </header>

  <main>
    <div id="lancamentos" class="card">
      <h3>ğŸ’¸ LanÃ§amentos</h3>
      <p>Base pronta (fase 2)</p>
    </div>

    <div id="historico" class="card hidden">
      <h3>ğŸ“Š HistÃ³rico</h3>
      <p>Base pronta (fase 3)</p>
    </div>
  </main>
</div>

<div class="toggle-dark" onclick="toggleDark()">ğŸŒ™</div>

<script>
const API =
  "https://script.google.com/macros/s/AKfycbxHjTzh9gF0yfw9LW7EGYTAshfKQJyRV7TCmhmJIQr9pVw4f00bmnZpwbhvtO2e7Fon5Q/exec"; // âš ï¸ COLE A URL DO DEPLOY

/* ================= LOGIN ================= */
function login() {
  const u = user.value.trim();
  const p = pass.value.trim();
  if (!u || !p) return;

  fetch(`${API}?action=login&user=${encodeURIComponent(u)}&pass=${encodeURIComponent(p)}`)
    .then(r => r.json())
    .then(j => {
      if (j.ok) {
        localStorage.setItem("user", j.usuario);
        localStorage.setItem("loginTime", Date.now());
        initApp();
      } else {
        loginErro.innerText = "UsuÃ¡rio ou senha invÃ¡lidos";
      }
    });
}

/* ================= SESSÃƒO ================= */
function initApp() {
  const user = localStorage.getItem("user");
  if (!user) return;

  const time = Number(localStorage.getItem("loginTime"));
  if (Date.now() - time > 10 * 60 * 1000) {
    logout();
    return;
  }

  loginView.classList.add("hidden");
  appView.classList.remove("hidden");
  userName.innerText = user;
  showTab("lancamentos");
}

function logout() {
  localStorage.clear();
  location.reload();
}

/* ================= TABS ================= */
function showTab(id) {
  document.querySelectorAll("main .card").forEach(c => c.classList.add("hidden"));
  document.getElementById(id).classList.remove("hidden");
}

/* ================= DARK MODE ================= */
function toggleDark() {
  document.body.classList.toggle("dark");
  localStorage.setItem("dark", document.body.classList.contains("dark"));
}

if (localStorage.getItem("dark") === "true") {
  document.body.classList.add("dark");
}

/* ================= INIT ================= */
initApp();
</script>

</body>
</html>
