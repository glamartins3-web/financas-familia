<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Controle Financeiro</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root{
 --bg:#f1f5f9;
 --card:#ffffff;
 --text:#0f172a;
 --primary:#2563eb;
 --ok:#16a34a;
 --bad:#dc2626;
 --warn:#f59e0b;
}
body.dark{
 --bg:#020617;
 --card:#020617;
 --text:#e5e7eb;
}
*{box-sizing:border-box}
body{
 margin:0;
 font-family:Segoe UI,Arial;
 background:var(--bg);
 color:var(--text);
}
input,select,button,table,th,td{
 background:var(--card);
 color:var(--text);
}
input,select{
 padding:8px;
 border-radius:8px;
 border:1px solid #999;
 width:100%;
}
button{
 padding:10px;
 border:none;
 border-radius:10px;
 background:var(--primary);
 color:#fff;
 cursor:pointer;
}
.hidden{display:none}
header{
 padding:12px;
 background:var(--card);
 display:flex;
 justify-content:space-between;
 box-shadow:0 2px 6px rgba(0,0,0,.15);
}
nav button{
 background:none;
 color:var(--text);
}
.card{
 background:var(--card);
 border-radius:16px;
 padding:16px;
 margin-bottom:16px;
}
.resumo{
 display:grid;
 grid-template-columns:repeat(3,1fr);
 gap:10px;
 text-align:center;
}
.rec{color:var(--ok)}
.desp{color:var(--bad)}
.saldo{color:var(--primary)}
table{width:100%;border-collapse:collapse}
th,td{padding:8px;border-bottom:1px solid #888;font-size:13px}
.status-pago{color:var(--ok);font-weight:bold}
.status-pendente{color:var(--warn);font-weight:bold}
.toggle-dark{
 position:fixed;bottom:14px;right:14px;
 background:var(--primary);
 color:#fff;
 padding:12px;
 border-radius:50%;
}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="loginView" class="card" style="max-width:360px;margin:60px auto">
 <h3>ğŸ” Login</h3>
 <input id="user" placeholder="UsuÃ¡rio">
 <input id="pass" type="password" placeholder="Senha">
 <button onclick="login()">Entrar</button>
 <p id="loginErro" style="color:red"></p>
</div>

<!-- APP -->
<div id="appView" class="hidden">
<header>
 <strong>ğŸ‘¤ <span id="userName"></span></strong>
 <nav>
  <button onclick="tab('lan')">ğŸ§¾ LanÃ§amentos</button>
  <button onclick="tab('hist')">ğŸ“Š HistÃ³rico</button>
  <button onclick="logout()">â»</button>
 </nav>
</header>

<main style="padding:16px">

<!-- LANÃ‡AMENTOS -->
<section id="lan">

<div class="card">
 <h4>â• Novo LanÃ§amento</h4>
 <div style="display:grid;gap:8px">
  <select id="tipo">
   <option>Receita</option>
   <option>Despesa</option>
  </select>
  <input type="date" id="data">
  <input id="desc" placeholder="DescriÃ§Ã£o">
  <input type="number" id="valor" placeholder="Valor">
  <label><input type="checkbox" id="pago"> Pago</label>
  <button onclick="salvar()">Salvar</button>
 </div>
</div>

<div class="card resumo">
 <div class="rec">Receitas<br><b id="r">0</b></div>
 <div class="desp">Despesas<br><b id="d">0</b></div>
 <div class="saldo">Saldo<br><b id="s">0</b></div>
</div>

<div class="card">
 <h4>ğŸ“‹ LanÃ§amentos</h4>
 <table>
  <thead>
   <tr><th>Data</th><th>DescriÃ§Ã£o</th><th>Valor</th><th>Status</th></tr>
  </thead>
  <tbody id="lista"></tbody>
 </table>
</div>
</section>

<!-- HISTÃ“RICO -->
<section id="hist" class="hidden">
 <div class="card">
  <canvas id="grafico"></canvas>
 </div>
 <div class="card">
  <h4>ğŸ“œ HistÃ³rico Completo</h4>
  <table>
   <thead>
    <tr><th>Data</th><th>DescriÃ§Ã£o</th><th>Valor</th><th>Tipo</th></tr>
   </thead>
   <tbody id="histLista"></tbody>
  </table>
 </div>
</section>

</main>
</div>

<div class="toggle-dark" onclick="dark()">ğŸŒ™</div>

<script>
const API="COLE_AQUI_SUA_URL_GAS";
let DB=[],USER="",chart;

/* UTIL */
const fmt=d=>{
 if(!d)return "";
 if(d instanceof Date)return d.toLocaleDateString("pt-BR");
 if(d.includes("-"))return d.split("-").reverse().join("/");
 return d;
}

/* LOGIN */
function login(){
 fetch(`${API}?action=login&user=${user.value}&pass=${pass.value}`)
 .then(r=>r.json()).then(j=>{
  if(!j.ok)return loginErro.innerText="Erro login";
  USER=j.usuario;
  loginView.classList.add("hidden");
  appView.classList.remove("hidden");
  userName.innerText=USER;
  load();
 })
}
function logout(){location.reload()}

/* TABS */
function tab(t){
 lan.classList.toggle("hidden",t!=="lan");
 hist.classList.toggle("hidden",t!=="hist");
 if(t==="hist")graf();
}

/* LOAD */
function load(){
 fetch(`${API}?action=listar`)
 .then(r=>r.json()).then(d=>{
  DB=d;
  render();
 })
}

/* SALVAR */
function salvar(){
 fetch(API,{
  method:"POST",
  body:JSON.stringify({
   data:data.value,
   desc:desc.value,
   valor:+valor.value,
   tipo:tipo.value,
   pago:pago.checked,
   user:USER
  })
 }).then(()=>load());
}

/* RENDER */
function render(){
 let r=0,d=0;
 lista.innerHTML="";
 histLista.innerHTML="";
 DB.forEach(l=>{
  if(l.tipo==="Receita")r+=l.valor; else d+=l.valor;
  lista.innerHTML+=`
   <tr>
    <td>${fmt(l.data)}</td>
    <td>${l.desc}</td>
    <td>R$ ${l.valor.toFixed(2)}</td>
    <td class="${l.pago?"status-pago":"status-pendente"}">${l.pago?"Pago":"Pendente"}</td>
   </tr>`;
  histLista.innerHTML+=`
   <tr>
    <td>${fmt(l.data)}</td>
    <td>${l.desc}</td>
    <td>R$ ${l.valor.toFixed(2)}</td>
    <td>${l.tipo}</td>
   </tr>`;
 });
 rEl.innerText=r; dEl.innerText=d; sEl.innerText=r-d;
}

/* GRÃFICO */
function graf(){
 const m={};
 DB.forEach(l=>{
  const k=l.data.slice(0,7);
  m[k]=m[k]||0;
  m[k]+=l.tipo==="Receita"?l.valor:-l.valor;
 });
 const labels=Object.keys(m);
 const data=Object.values(m);
 if(chart)chart.destroy();
 chart=new Chart(grafico,{
  type:"bar",
  data:{labels,datasets:[{label:"Saldo",data}]}
 });
}

/* UI */
function dark(){
 document.body.classList.toggle("dark");
}
</script>

</body>
</html>
